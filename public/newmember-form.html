<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IDAIC Member Registration</title>
  <link rel="stylesheet" href="/tailwind.css">
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="bg-gray-50">
  <div class="min-h-screen py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-4xl mx-auto">
      <!-- Logo -->
      <div class="flex justify-center mb-8">
        <a href="https://www.idaic.org" target="_blank" rel="noopener noreferrer" class="cursor-pointer hover:opacity-80 transition-opacity">
          <img id="idaic-logo" alt="IDAIC Logo" class="h-20 w-auto object-contain" style="display: none;" />
        </a>
      </div>

      <!-- Opening Notice -->
      <div id="notice-section" class="bg-white rounded-lg shadow-lg p-6 sm:p-8 mb-6">
        <h2 class="text-lg font-semibold mb-3 text-gray-900">
          Notice - members portal
        </h2>
        <p class="text-sm leading-relaxed text-gray-600">
          We're currently creating our members portal to include more detailed member profiles and a library showcasing members' ongoing or completed projects. This will help other members better understand your work and potentially reach out for collaboration through our platform. Projects seeking collaboration with industry partners or AI technology experts will be specially tagged.
        </p>
      </div>

      <!-- Form -->
      <div class="bg-white rounded-lg shadow-lg p-6 sm:p-8">
        <h1 class="text-2xl font-bold mb-6 text-center text-gray-900">
          IDAIC Member Registration
        </h1>

        <!-- Success Message -->
        <div id="success-message" class="hidden mb-4 p-6 bg-green-50 border border-green-200 rounded-md text-center">
          <div class="mb-4">
            <svg class="mx-auto h-12 w-12 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
          <h3 class="text-lg font-semibold text-green-800 mb-2">Thank you for your registration!</h3>
          <p class="text-sm text-green-700 mb-4">
            The IDAIC team in your respective region will review your submission and get in touch with you soon.
          </p>
          <p class="text-xs text-green-600">
            You will be redirected to <a href="https://www.idaic.org" class="underline font-medium">www.idaic.org</a> in <span id="countdown">5</span> seconds...
          </p>
        </div>

        <!-- Error Message -->
        <div id="error-message" class="hidden mb-4 p-4 bg-red-50 border border-red-200 rounded-md">
          <p class="text-sm text-red-800" id="error-text"></p>
        </div>

        <form id="registration-form" class="space-y-6">
          <!-- Basic Information -->
          <div class="border-b pb-6">
            <h3 class="text-base font-semibold mb-4 text-gray-900">
              Basic Information
            </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-medium mb-1 text-gray-900">
                  Name *
                </label>
                <input
                  type="text"
                  id="name"
                  name="name"
                  required
                  class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-orange-500"
                />
              </div>

              <div>
                <label class="block text-sm font-medium mb-1 text-gray-900">
                  Email *
                </label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  required
                  class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-orange-500"
                />
              </div>

              <div>
                <label class="block text-sm font-medium mb-1 text-gray-900">
                  Company
                </label>
                <input
                  type="text"
                  id="company"
                  name="company"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-orange-500"
                />
              </div>

              <div>
                <label class="block text-sm font-medium mb-1 text-gray-900">
                  Title/Position
                </label>
                <input
                  type="text"
                  id="title"
                  name="title"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-orange-500"
                />
              </div>

              <div>
                <label class="block text-sm font-medium mb-1 text-gray-900">
                  Region
                </label>
                <select
                  id="region"
                  name="region"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-orange-500 cursor-pointer"
                >
                  <option value="">Select Region</option>
                  <option value="UK">UK</option>
                  <option value="UAE">UAE</option>
                  <option value="EU">EU</option>
                  <option value="MENA">MENA</option>
                  <option value="Global">Global</option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium mb-1 text-gray-900">
                  LinkedIn URL
                </label>
                <input
                  type="url"
                  id="linkedin_url"
                  name="linkedin_url"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-orange-500"
                  placeholder="https://linkedin.com/in/..."
                />
              </div>
            </div>
          </div>

          <!-- Data Permission -->
          <div class="border-b pb-6">
            <h3 class="text-base font-semibold mb-2 text-gray-900">
              Data Permission
            </h3>
            <p class="text-sm mb-3 text-gray-600">
              User consent to display their information on the member section
            </p>
            <label class="flex items-center">
              <input
                type="checkbox"
                id="data_permission"
                name="data_permission"
                class="w-4 h-4 text-orange-500 border-gray-300 rounded focus:ring-orange-500"
              />
              <span class="ml-2 text-sm text-gray-900">
                I agree that IDAIC have permission to process my data and host this information on the member section of the IDAIC website
              </span>
            </label>
          </div>

          <!-- Additional Information -->
          <div class="border-b pb-6">
            <h3 class="text-base font-semibold mb-4 text-gray-900">
              Additional Information
            </h3>

              <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <div class="lg:col-span-2">
                  <label class="block text-sm font-medium mb-1 text-gray-900">
                    What Category fits best:
                  </label>
                  <select
                    id="category"
                    name="category"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-orange-500 cursor-pointer"
                  >
                    <option value="">Select a category</option>
                    <option value="Represent industrial company">Represent industrial company</option>
                    <option value="Represent AI developer / provider">Represent AI developer / provider</option>
                    <option value="Represent research centre / university">Represent research centre / university</option>
                    <option value="Represent investor">Represent investor</option>
                    <option value="Other">Other: (please specify)</option>
                  </select>
                </div>

                <div id="other-category-container" class="lg:col-span-2 hidden">
                  <label class="block text-sm font-medium mb-1 text-gray-900">
                    Please specify:
                  </label>
                  <input
                    type="text"
                    id="other_category"
                    name="other_category"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-orange-500"
                    placeholder="Specify your category"
                  />
                </div>

              <div>
                <label class="block text-sm font-medium mb-1 text-gray-900">
                  What does the organization you represent do?
                </label>
                <textarea
                  id="organization_description"
                  name="organization_description"
                  rows="3"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-orange-500"
                ></textarea>
              </div>

              <div>
                <label class="block text-sm font-medium mb-1 text-gray-900">
                  In what ways are you exploring or planning to use AI to accelerate decarbonisation within your organization?
                </label>
                <textarea
                  id="ai_decarbonisation"
                  name="ai_decarbonisation"
                  rows="3"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-orange-500"
                ></textarea>
              </div>

              <div>
                <label class="block text-sm font-medium mb-1 text-gray-900">
                  What are the key challenges you face in implementing AI for decarbonisation?
                </label>
                <textarea
                  id="challenges"
                  name="challenges"
                  rows="3"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-orange-500"
                ></textarea>
              </div>

              <div>
                <label class="block text-sm font-medium mb-1 text-gray-900">
                  How might you contribute to addressing those challenges?
                </label>
                <textarea
                  id="contribution"
                  name="contribution"
                  rows="3"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-orange-500"
                ></textarea>
              </div>

              <div>
                <label class="block text-sm font-medium mb-1 text-gray-900">
                  Are there any specific projects or initiatives you would like to share with the community?
                </label>
                <textarea
                  id="projects"
                  name="projects"
                  rows="3"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-orange-500"
                ></textarea>
              </div>

              <div>
                <label class="block text-sm font-medium mb-1 text-gray-900">
                  What AI tools and technologies are you currently using or planning to use?
                </label>
                <textarea
                  id="ai_tools"
                  name="ai_tools"
                  rows="3"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-orange-500"
                ></textarea>
              </div>
            </div>
          </div>

          <!-- Disclaimer -->
          <div class="mb-6 bg-gray-50 rounded-lg p-6">
            <h2 class="text-lg font-semibold mb-4 text-gray-900">
              Disclaimer
            </h2>
            <div class="text-sm space-y-3 text-gray-600">
              <p>
                This form is managed by <a href="https://www.nexusclimate.vc" target="_blank" rel="noopener noreferrer" class="text-orange-500 hover:text-orange-600 underline">Nexus Climate</a>. By submitting this form you agree that Nexus Climate will store and process the information you submit for the purpose of administering your participation in IDAIC and managing related activities. You agree that your information will be shared with the IDAIC team, Cleantech for UK, and Innovate UK for the purposes of running the coalition and its activities.
              </p>
              <p class="italic text-xs text-gray-600">
                Nexus Climate is the trading name of Nexus Climate LTD, a company incorporated in England and Wales with company number 15267106, and Nexus Climate Consultancy Ltd, registered in the Dubai International Financial Center (DIFC), Dubai, UAE, under registration number 425675 and licence number CL8040. For more details on how we handle your personal data, please review our
                <a 
                  href="https://nexusclimate.vc/privacy-policy" 
                  target="_blank" 
                  rel="noopener noreferrer"
                  class="text-orange-500 hover:text-orange-600 underline"
                >
                  Privacy Policy
                </a>.
              </p>
            </div>
          </div>

          <!-- Submit Button -->
          <div class="flex justify-center">
            <button
              type="submit"
              id="submit-btn"
              class="px-8 py-3 bg-orange-500 text-white rounded-md text-base font-medium hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Submit Registration
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Fetch IDAIC logo from organizations database
    async function loadIdaicLogo() {
      try {
        const response = await fetch('/.netlify/functions/orgs');
        if (response.ok) {
          const orgs = await response.json();
          // Find IDAIC organization - check for various possible names
          const idaic = orgs.find(org => 
            org.name && (
              org.name.toLowerCase().includes('idaic') ||
              org.name.toLowerCase() === 'idaic'
            ) && org.logo_url
          );
          if (idaic && idaic.logo_url) {
            const logoImg = document.getElementById('idaic-logo');
            logoImg.src = idaic.logo_url;
            logoImg.style.display = 'block';
          }
        }
      } catch (err) {
        console.error('Error fetching IDAIC logo:', err);
      }
    }

    // Load logo on page load
    loadIdaicLogo();

    // Handle category dropdown - show/hide other category field
    const categorySelect = document.getElementById('category');
    const otherCategoryContainer = document.getElementById('other-category-container');
    const otherCategoryInput = document.getElementById('other_category');

    if (categorySelect && otherCategoryContainer) {
      categorySelect.addEventListener('change', (e) => {
        if (e.target.value === 'Other') {
          otherCategoryContainer.classList.remove('hidden');
          if (otherCategoryInput) {
            otherCategoryInput.required = true;
          }
        } else {
          otherCategoryContainer.classList.add('hidden');
          if (otherCategoryInput) {
            otherCategoryInput.required = false;
            otherCategoryInput.value = '';
          }
        }
      });
    }

    const form = document.getElementById('registration-form');
    const submitBtn = document.getElementById('submit-btn');
    const successMessage = document.getElementById('success-message');
    const errorMessage = document.getElementById('error-message');
    const errorText = document.getElementById('error-text');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Hide previous messages
      successMessage.classList.add('hidden');
      errorMessage.classList.add('hidden');
      
      // Validate category field
      const categoryValue = document.getElementById('category').value.trim();
      if (categoryValue === 'Other') {
        const otherCategoryValue = document.getElementById('other_category').value.trim();
        if (!otherCategoryValue) {
          errorText.textContent = 'Please specify your category when selecting "Other".';
          errorMessage.classList.remove('hidden');
          otherCategoryContainer.classList.remove('hidden');
          if (otherCategoryInput) {
            otherCategoryInput.focus();
          }
          return;
        }
      }
      
      // Disable submit button
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';
      
      // Collect form data
      const formData = {
        name: document.getElementById('name').value.trim(),
        email: document.getElementById('email').value.trim(),
        company: document.getElementById('company').value.trim(),
        title: document.getElementById('title').value.trim(),
        region: document.getElementById('region').value,
        linkedin_url: document.getElementById('linkedin_url').value.trim(),
        data_permission: document.getElementById('data_permission').checked,
        category: document.getElementById('category').value.trim(),
        other_category: document.getElementById('category').value === 'Other' ? document.getElementById('other_category').value.trim() : '',
        organization_description: document.getElementById('organization_description').value.trim(),
        ai_decarbonisation: document.getElementById('ai_decarbonisation').value.trim(),
        challenges: document.getElementById('challenges').value.trim(),
        contribution: document.getElementById('contribution').value.trim(),
        projects: document.getElementById('projects').value.trim(),
        ai_tools: document.getElementById('ai_tools').value.trim(),
        role: 'new' // Set role to 'new' for new member form submissions
      };

      try {
        const response = await fetch('/.netlify/functions/userProfile', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });

        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error || 'Failed to submit form');
        }

        // Show success message
        successMessage.classList.remove('hidden');
        
        // Hide form and notice section
        form.style.display = 'none';
        const noticeSection = document.getElementById('notice-section');
        if (noticeSection) {
          noticeSection.style.display = 'none';
        }
        
        // Scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });
        
        // Countdown and redirect
        let countdown = 5;
        const countdownElement = document.getElementById('countdown');
        const redirectInterval = setInterval(() => {
          countdown--;
          if (countdownElement) {
            countdownElement.textContent = countdown;
          }
          if (countdown <= 0) {
            clearInterval(redirectInterval);
            window.location.href = 'https://www.idaic.org';
          }
        }, 1000);
      } catch (err) {
        // Show error message
        errorText.textContent = err.message;
        errorMessage.classList.remove('hidden');
        
        // Scroll to error message
        errorMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      } finally {
        // Re-enable submit button
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Registration';
      }
    });
  </script>
</body>
</html>

